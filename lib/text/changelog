Vitalia Reborn - Technical Changelog
=====================================
Developer-facing notes.  Player-readable summaries are in lib/text/news.

--- Janeiro e Fevereiro de 2026 ---

SEC energy partitioning (src/sec.c / sec.h):
   Fixed emotional state leakage and implemented SEC energy partitioning.
   The SEC (Competing Emotions System) now normalises fear, anger, and
   happiness so that their sum never exceeds the 4D Arousal value.
   A Winner-Takes-All filter was added to the social-action selector,
   preventing contradictory behaviours (e.g., biting and praising in the
   same tick) by requiring any chosen social category to carry at least
   60 % of the dominant SEC emotional weight.

OCEAN Agreeableness (A) and Extraversion (E) (src/sec.c):
   Implemented OCEAN Agreeableness (A) and Extraversion (E) as structural
   personality modulators:
   - Agreeableness damps anger gain when attacked: high-A mobs absorb
     conflict without escalating (Anger_gain *= 1.2 - A).
   - Agreeableness accelerates anger decay (forgiveness): high-A mobs
     release anger faster toward baseline.
   - Extraversion modulates social action probability: high-E mobs
     interact more frequently; low-E mobs are more reserved.
   Traits never inject emotional values; they only adjust gain/decay rates,
   preserving SEC energy conservation.

OCEAN Conscientiousness (C) (src/sec.c, src/shadow_timeline.c):
   Implemented OCEAN Conscientiousness (C) as temporal stabilizer:
   - C regulates SEC alpha smoothing: high-C mobs resist sudden emotional
     spikes (alpha_eff = alpha_base * (1.2 - 0.5*C), clamped [0.05, 0.95]).
   - C adds emotional persistence: high-C mobs hold dominant emotional
     states longer (decay *= 1.2 - 0.6*C applied to fear/anger/happiness).
   - C adds decision consistency bias in Shadow Timeline: score bonus for
     actions matching the prior commitment (0 to +12 based on C_final).
   - C_final = C_base + builder_modifier/100 + sec_mod (capped +/-0.05).
   - Added ConscientiousnessModifier builder field with save/load support.
   - Stat command now shows C base/builder/sec_mod/final breakdown.

OCEAN Neuroticism (N) (src/sec.c):
   Implemented OCEAN Neuroticism (N) as structural volatility amplifier:
   - N amplifies negative emotion gain via sec_get_neuroticism_final():
     existing apply_neuroticism_gain() pipeline now uses N_final instead
     of raw base (builder modifier and bounded SEC stress modulation).
   - N adds decay resistance to fear/anger: high-N mobs ruminate longer
     (fear_decay *= 1.2 - 0.6*N, anger_decay *= 1.2 - 0.5*N; clamped
     to prevent sign inversion or zeroing of decay).
   - N_final = N_base + builder_modifier/100 + N_mod (capped +/-0.05).
     N_mod = clamp(0.05 * (sec.fear + sec.anger), -0.05, +0.05) -- prevents
     recursive amplification loops (fear escalates N, N amplifies fear).
   - Added NeuroticismModifier builder field with save/load support.
   - Stat command now shows N base/builder/sec_mod/final breakdown.

OCEAN Openness (O) (src/sec.c, src/shadow_timeline.c):
   Implemented OCEAN Openness (O) as structurally stable cognitive trait:
   - O_base generated via Gaussian distribution (mu=0.5, sigma=0.15) at
     spawn; replaces the hardcoded 0.5f placeholder.
   - O_builder applied as delta (never replaces base); +/-50 range.
   - O_mod = 0 by design -- Openness must NEVER derive from SEC emotional
     state to avoid SEC <-> utility feedback loops.
   - O_final influences Shadow Timeline MOVE novelty weighting:
     score += (O_final - 0.5) * 14.0  (range -7 to +7 points on MOVE).
     High-O mobs explore more freely; low-O mobs prefer familiar territory.
   - O does NOT influence emotional gain/decay, SEC partition, or WTA gating.
   - Added OpennessModifier builder field with Openness/OpennessModifier
     save/load support.
   - Stat command now shows O base/builder/sec_mod/final breakdown.

OCEAN Openness (O) -- cognitive flexibility depth model (src/shadow_timeline.c):
   Extended OCEAN Openness (O) with full cognitive flexibility mechanisms:
   - Replaced binary novelty bonus with depth-aware model to prevent
     oscillation in high-O mobs:
       bonus = min(O * depth * 6, 30)  where depth = consecutive repetitions
     No pressure at depth=0, gentle at depth=1 (+6 pts), hard cap at depth=5
     (+30 pts = 0.3 * OUTCOME_SCORE_MAX).  High-O mobs need sustained
     repetition before novelty pressure outweighs survival utility -- this
     eliminates "ADHD flip-flop" while preserving genuine behavioral variety.
   - Added action_repetition_count to mob_ai_data: incremented each tick
     the same action type is chosen, reset to 1 on type change.
   - Repetition dampening: low-O mobs gain +(1-O)*15 pts for same-type
     repetition (routine preference).
   - Exploration probability gate in shadow_select_best_action(): with
     probability (O*20)% a random non-negative sub-dominant action is
     selected. WTA energy gating is preserved.
   - Ambiguity tolerance in prediction-error feedback: threat amplification
     scales with (1 - 0.4*O), range 18-30%.
   All O mechanisms act at the decision/interpretation layer only; no
   emotional gain, decay, or SEC partition is affected.

Emotion memory buffer / stat display (src/act.wizard.c):
   - stat mob "Emotion Memory" header hardcoded "10" as max slots; changed
     to EMOTION_MEMORY_SIZE (20).
   - interaction_names[] array only covered types 0-9; extended to cover
     all 16 defined INTERACT_* constants (0-15), including:
       INTERACT_WITNESSED_DEATH (10), INTERACT_QUEST_COMPLETE (11),
       INTERACT_QUEST_FAIL (12), INTERACT_BETRAYAL (13),
       INTERACT_WITNESSED_OFFENSIVE_MAGIC (14),
       INTERACT_WITNESSED_SUPPORT_MAGIC (15).
     Bounds check updated from <= 9 to <= 15.

Duplicate follow message in SHADOW_ACTION_FOLLOW (src/mobact.c):
   - SHADOW_ACTION_FOLLOW manually sent "comeca a seguir" act() messages
     before calling add_follower(), which already sends those same messages.
     Removed the redundant act() calls and the dead stop_follower() guard
     (unreachable: outer !ch->master check guarantees master is NULL there).

ALLY_DIED vs UNRELATED_DIED differentiation (src/utils.c, fight.c,
                                              act.movement.c):
   - mob_mourn_death() used general emotion levels (friendship >= 60,
     love >= 50, loyalty >= 60) to determine is_close_relationship.
     These are global stats, not entity-specific bonds, so any friendly or
     high-compassion mob would record INTERACT_ALLY_DIED for strangers and
     emit "era tudo para mim" lines.
   - Added static mob_has_positive_memory_of() helper (utils.c): scans
     emotion memory for positive interaction types with the specific entity
     (INTERACT_HEALED, INTERACT_RECEIVED_ITEM, INTERACT_RESCUED,
      INTERACT_ASSISTED, INTERACT_SOCIAL_POSITIVE).
   - is_close_relationship is now TRUE only for same-group members or mobs
     with recorded positive memories of the deceased.
   - update_mob_emotion_ally_died() is only called for true allies;
     non-ally witnesses receive mild fear/horror (rand 3-8 / 2-6) instead.
   - Removed duplicate update_mob_emotion_ally_died() calls in fight.c and
     act.movement.c that double-counted the ally emotion update for group
     members already handled inside mob_mourn_death().
